<!DOCTYPE html>
<html lang="sv">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-E6BYGDHEZ9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-E6BYGDHEZ9');
    </script>

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KKPQ9SDX');</script>
    <!-- End Google Tag Manager -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>August's Wallet Bildverktyg</title>

    <style>
        :root {
            --blue: #2563eb;
            --blue-dark: #1d4ed8;
            --green: #16a34a;
            --orange: #f97316;
            --border: #d1d5db;
            --bg: #f3f4f6;
            --text: #0b2a3a;
            --accent-pink: #ec4d71;
            --muted: #6b7280;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 1.5rem;
            background: var(--bg);
            color: var(--text);
        }

        .page {
            max-width: 1100px;
            margin: 0 auto;
        }

        h1 {
            margin-top: 0;
            font-size: 2rem;
            text-align: center;
            margin-bottom: 0.25rem;
        }

        .lead {
            text-align: center;
            color: #4b5563;
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
        }

        .card {
            background: #fff;
            padding: 1.5rem 1.75rem;
            border-radius: 0.9rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            margin-bottom: 1.5rem;
        }

        .card h2 {
            margin-top: 0;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 1.6rem;
            height: 1.6rem;
            border-radius: 999px;
            background: var(--blue);
            color: white;
            font-size: 0.9rem;
            font-weight: 700;
        }

        .field-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }

        input[type="file"],
        input[type="checkbox"] {
            font-family: inherit;
        }

        input[type="file"] {
            font-size: 0.9rem;
        }

        .help {
            font-size: 0.8rem;
            color: var(--muted);
            margin-top: 0.2rem;
        }

        .row {
            display: flex;
            flex-wrap: wrap;
            gap: 0.9rem;
        }

        .row > .col {
            flex: 1 1 220px;
            min-width: 0;
        }

        .checkbox-line {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
        }

        button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.35rem;
            padding: 0.6rem 1.2rem;
            border-radius: 999px;
            border: none;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            background: var(--blue);
            color: white;
            box-shadow: 0 4px 12px rgba(37,99,235,0.35);
            transition: transform 0.05s ease, box-shadow 0.05s ease, background 0.2s;
        }

        button:disabled {
            opacity: 0.6;
            cursor: default;
            box-shadow: none;
        }

        button:not(:disabled):hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 18px rgba(37,99,235,0.45);
            background: var(--blue-dark);
        }

        .btn-secondary {
            background: #6b7280;
            box-shadow: 0 4px 12px rgba(55,65,81,0.35);
        }
        .btn-secondary:hover:not(:disabled) {
            background: #4b5563;
        }

        .btn-green {
            background: var(--green);
            box-shadow: 0 4px 12px rgba(22,163,74,0.4);
        }
        .btn-green:hover:not(:disabled) {
            background: #15803d;
        }

        .status {
            margin-top: 0.5rem;
            font-size: 0.85rem;
            min-height: 1.2rem;
        }

        .status--info {
            color: #374151;
        }

        .status--ok {
            color: #065f46;
        }

        .status--error {
            color: #b91c1c;
        }

        .asset-list {
            margin-top: 1rem;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
            gap: 0.75rem;
        }

        .asset-item {
            background: #f9fafb;
            border-radius: 0.75rem;
            border: 1px solid #e5e7eb;
            padding: 0.75rem 0.9rem;
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        .asset-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
        }

        .asset-name {
            font-weight: 600;
        }

        .asset-size-pill {
            padding: 0.1rem 0.5rem;
            border-radius: 999px;
            background: #e5e7eb;
            font-size: 0.75rem;
            color: #4b5563;
        }

        .asset-actions {
            margin-top: 0.2rem;
        }

        .asset-actions a {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.3rem 0.85rem;
            border-radius: 999px;
            text-decoration: none;
            background: var(--orange);
            color: #fff;
            font-size: 0.8rem;
            box-shadow: 0 2px 8px rgba(249,115,22,0.4);
        }

        .asset-actions a:hover {
            background: #ea580c;
        }

        /* --- Wallet previews --- */

        .preview-grid {
            display: flex;
            justify-content: center;
            margin-top: 0.75rem;
        }

        .wallet-preview-wrapper {
            max-width: 360px;
            width: 100%;
        }

        .wallet-preview-label {
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 0.35rem;
            color: var(--muted);
        }

        .wallet-preview {
            border-radius: 1.1rem;
            background: #ffffff;
            padding: 1.0rem 1.2rem 1.15rem;
            color: var(--text);
            box-shadow:
                0 0 0 1px rgba(15,23,42,0.04),
                0 8px 22px rgba(15,23,42,0.18);
            position: relative;
            overflow: hidden;
            font-size: 0.8rem;
        }

        .wallet-inner {
            position: relative;
            z-index: 1;
        }

        .ticket-header {
            display: flex;
            justify-content: flex-start; /* logga v√§nster */
            align-items: center;
            margin-bottom: 0.8rem;
            margin-top: 0.2rem;
        }

        .ticket-logo {
            width: 160px;
            max-width: 190px;
            height: 48px;
            border-radius: 0.5rem;
            background: #f1f5f9;
            background-position: left center;
            background-size: contain;
            background-repeat: no-repeat;
        }

        .ticket-section {
            margin-bottom: 0.75rem;
        }

        .ticket-label {
            font-size: 0.68rem;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            color: var(--accent-pink);
            margin-bottom: 0.12rem;
        }

        .ticket-value {
            font-size: 0.82rem;
            color: var(--text);
        }

        .ticket-value-lg {
            font-size: 1.0rem;
            font-weight: 600;
            line-height: 1.25;
        }

        .ticket-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            column-gap: 1.5rem;
            row-gap: 0.6rem;
            margin-bottom: 0.9rem;
        }

        .ticket-col {
            display: flex;
            flex-direction: column;
            gap: 0.55rem;
        }

        .ticket-field {
            padding-bottom: 0.35rem;
            border-bottom: 1px solid #edf1f5;
        }

        .ticket-field:last-child {
            border-bottom: none;
        }

        .ticket-qr-area {
            margin-top: 0.5rem;
            padding-top: 0.7rem;
            border-top: 1px solid #edf1f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.4rem;
        }

        .ticket-qr-box {
            width: 42%;
            min-width: 135px;
            aspect-ratio: 1 / 1;
            border-radius: 0.9rem;
            background-color: #ffffff;
            box-shadow:
                0 0 0 1px #e5e7eb,
                0 4px 14px rgba(15,23,42,0.15);
            position: relative;
            overflow: hidden;
        }

        .ticket-qr-box::before {
            content: "";
            position: absolute;
            inset: 16%;
            background:
                repeating-linear-gradient(
                    to right,
                    #000 0,
                    #000 2px,
                    transparent 2px,
                    transparent 4px
                ),
                repeating-linear-gradient(
                    to bottom,
                    #000 0,
                    #000 2px,
                    transparent 2px,
                    transparent 4px
                );
            opacity: 0.88;
        }

        .ticket-qr-caption {
            font-size: 0.72rem;
            color: #9ca3af;
            text-align: center;
        }

        .preview-note {
            font-size: 0.8rem;
            color: var(--muted);
            margin-top: 0.8rem;
        }

        /* --- Extra vyer: listvy, watch, l√•ssk√§rm --- */

        .extra-previews {
            display: flex;
            flex-wrap: wrap;
            gap: 1.4rem;
            margin-top: 1.4rem;
            align-items: flex-start;
        }

        .mini-caption-title {
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 0.2rem;
        }

        .mini-caption {
            font-size: 0.78rem;
            color: var(--muted);
            margin-top: 0.35rem;
            max-width: 260px;
        }

        /* Wallet-listvy */
        .wallet-listcell {
            width: 260px;
            border-radius: 0.9rem;
            background: #111827;
            padding: 0.55rem 0.7rem;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            color: #e5e7eb;
            box-shadow: 0 8px 18px rgba(15,23,42,0.45);
            font-size: 0.8rem;
        }

        .wallet-list-icon {
            width: 24px;
            height: 24px;
            border-radius: 0.7rem;
            background: #020617;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            overflow: hidden;
            background-position: center;
            background-size: cover;
            background-repeat: no-repeat;
        }

        .wallet-list-icon.has-image {
            color: transparent;
        }

        .wallet-list-text-main {
            font-weight: 600;
        }

        .wallet-list-text-sub {
            font-size: 0.72rem;
            color: #9ca3af;
        }

        /* Apple Watch-vy */
        .watch-preview {
            width: 160px;
            height: 200px;
            border-radius: 1.9rem;
            padding: 0.5rem;
            background: radial-gradient(circle at top, #020617, #0b1120 70%);
            box-shadow: 0 14px 26px rgba(15,23,42,0.6);
            color: #e5e7eb;
            font-size: 0.75rem;
            position: relative;
        }

        .watch-inner {
            width: 100%;
            height: 100%;
            border-radius: 1.5rem;
            padding: 0.5rem;
            background: linear-gradient(135deg, rgba(248,250,252,0.96), rgba(226,232,240,0.96));
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
            color: var(--text);
        }

        .watch-header {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .watch-icon {
            width: 20px;
            height: 20px;
            border-radius: 0.6rem;
            background: #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
            overflow: hidden;
            background-position: center;
            background-size: cover;
            background-repeat: no-repeat;
        }

        .watch-icon.has-image {
            color: transparent;
        }

        .watch-title {
            font-size: 0.78rem;
            font-weight: 600;
        }

        .watch-logo-strip {
            margin-top: 0.25rem;
            border-radius: 0.5rem;
            background: #f1f5f9;
            padding: 0.3rem 0.4rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .watch-logo {
            width: 60px;
            height: 18px;
            border-radius: 0.3rem;
            background: #e5e7eb;
            background-position: center;
            background-size: contain;
            background-repeat: no-repeat;
        }

        .watch-field-line {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            margin-top: 0.2rem;
        }

        .watch-barcode {
            margin-top: auto;
            height: 12px;
            border-radius: 999px;
            background-image: repeating-linear-gradient(
                to right,
                rgba(15,23,42,0.9) 0,
                rgba(15,23,42,0.9) 4px,
                transparent 4px,
                transparent 7px
            );
        }

        /* L√•ssk√§rm-vy */
        .lockscreen-phone {
            width: 210px;
            aspect-ratio: 9 / 19.5;
            border-radius: 2rem;
            padding: 0.7rem;
            background: radial-gradient(circle at top, #1f2937, #020617 70%);
            box-shadow: 0 18px 35px rgba(15,23,42,0.65);
            position: relative;
            color: #e5e7eb;
            font-size: 0.7rem;
            overflow: hidden;
        }

        .lockscreen-inner {
            width: 100%;
            height: 100%;
            border-radius: 1.6rem;
            padding: 0.6rem 0.5rem;
            background: linear-gradient(to bottom, rgba(148,163,184,0.1), rgba(15,23,42,0.6));
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .lockscreen-statusbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.65rem;
            opacity: 0.7;
        }

        .lockscreen-time {
            text-align: center;
            margin-top: 0.35rem;
            font-size: 1.7rem;
            font-weight: 500;
        }

        .lockscreen-notification {
            margin-top: auto;
            background: rgba(15,23,42,0.88);
            border-radius: 1.1rem;
            padding: 0.5rem 0.55rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 8px 18px rgba(0,0,0,0.45);
        }

        .lockscreen-icon {
            width: 26px;
            height: 26px;
            border-radius: 0.7rem;
            background: #111827;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
            color: #e5e7eb;
            overflow: hidden;
            background-position: center;
            background-size: cover;
            background-repeat: no-repeat;
        }

        .lockscreen-icon.has-image {
            color: transparent;
        }

        @media (max-width: 640px) {
            .card {
                padding: 1.2rem 1.1rem;
            }

            .wallet-preview-wrapper {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KKPQ9SDX"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <div class="page">
        <h1>Augusts Wallet-bildverktyg</h1>
        <p class="lead">
            Ladda upp en eller flera bilder och f√• ut f√§rdiga <strong>icon</strong> &amp; <strong>logo</strong>-filer
            i r√§tt storlek/namn ‚Äì plus f√∂rhandsvisningar av hur samma biljett kan se ut i olika Wallet-vyer
            (full biljett, lista, Apple Watch och l√•ssk√§rm).
        </p>

        <!-- STEG 1: UPPLADDNING & SKALNING -->
        <section class="card">
            <h2><span class="badge">1</span> Ladda upp bilder &amp; skala om</h2>

            <div class="field-group">
                <label class="checkbox-line">
                    <input type="checkbox" id="useGlobal" />
                    En bild f√∂r alla storlekar
                </label>
                <div class="help">
                    Bockad = samma original anv√§nds f√∂r alla varianter (icon/logo i alla @-storlekar).<br>
                    Avbockad = du kan ladda upp egna filer per storlek.
                </div>
            </div>

            <div id="globalUpload" class="field-group">
                <label for="globalFile">En bild f√∂r alla:</label>
                <input type="file" id="globalFile" accept="image/*">
                <div class="help">
                    Helst en h√∂guppl√∂st kvadratisk bild (t.ex. 1024√ó1024) med transparens.
                </div>
            </div>

            <div id="individualUploads" class="field-group">
                <div class="row">
                    <div class="col">
                        <label>Icon (liten symbol)</label>
                        <input type="file" class="file-input" data-key="icon" accept="image/*">
                        <div class="help">icon.png ‚Äì 29√ó29 px</div>
                    </div>
                    <div class="col">
                        <label>Icon @2x</label>
                        <input type="file" class="file-input" data-key="icon2x" accept="image/*">
                        <div class="help">icon@2x.png ‚Äì 58√ó58 px</div>
                    </div>
                    <div class="col">
                        <label>Icon @3x</label>
                        <input type="file" class="file-input" data-key="icon3x" accept="image/*">
                        <div class="help">icon@3x.png ‚Äì 87√ó87 px</div>
                    </div>
                </div>

                <div class="row" style="margin-top:0.75rem;">
                    <div class="col">
                        <label>Logo (huvudlogotyp)</label>
                        <input type="file" class="file-input" data-key="logo" accept="image/*">
                        <div class="help">logo.png ‚Äì 100√ó50 px (Apple f√∂resl√•r 160√ó50 pt)</div>
                    </div>
                    <div class="col">
                        <label>Logo @2x</label>
                        <input type="file" class="file-input" data-key="logo2x" accept="image/*">
                        <div class="help">logo@2x.png ‚Äì 200√ó100 px</div>
                    </div>
                    <div class="col">
                        <label>Logo @3x</label>
                        <input type="file" class="file-input" data-key="logo3x" accept="image/*">
                        <div class="help">logo@3x.png ‚Äì 300√ó150 px</div>
                    </div>
                </div>
            </div>

            <div class="field-group">
                <div class="row" style="align-items:center;">
                    <div class="col" style="flex:0 0 auto;">
                        <button id="processBtn" type="button">Skala om &amp; skapa filer</button>
                    </div>
                    <div class="col" style="flex:0 0 auto;">
                        <button id="resetBtn" type="button" class="btn-secondary">Rensa resultat</button>
                    </div>
                </div>
                <div id="statusText" class="status status--info"></div>
            </div>

            <div id="downloadLinks" class="asset-list"></div>
        </section>

        <!-- STEG 2: F√ñRHANDSVISNING -->
        <section class="card">
            <h2><span class="badge">2</span> F√∂rhandsvisning ‚Äì samma biljett i olika vyer</h2>
            <p class="help">
                Layouten nedan f√∂rs√∂ker spegla en klassisk eventbiljett i Wallet: vit bakgrund, logga uppe till v√§nster,
                tv√• kolumner med rubriker i rosa versaler och text i m√∂rk bl√•, samt QR-kod i en egen ruta nederst.
                N√§r du skalar om bilderna uppdateras f√∂rhandsvisningen automatiskt.
            </p>

            <!-- Full Wallet-biljettvy -->
            <div class="preview-grid">
                <div class="wallet-preview-wrapper">
                    <div class="wallet-preview-label">Wallet ‚Äì biljettvy (full vy)</div>
                    <div class="wallet-preview">
                        <div class="wallet-inner">
                            <div class="ticket-header">
                                <div class="ticket-logo" data-slot="logo"></div>
                            </div>

                            <div class="ticket-section">
                                <div class="ticket-label">Event</div>
                                <div class="ticket-value ticket-value-lg">
                                    Rockieli-plock
                                </div>
                            </div>

                            <div class="ticket-grid">
                                <div class="ticket-col">
                                    <div class="ticket-field">
                                        <div class="ticket-label">Section</div>
                                        <div class="ticket-value">F√∂rsta parkett</div>
                                    </div>
                                    <div class="ticket-field">
                                        <div class="ticket-label">Ticket</div>
                                        <div class="ticket-value">Ordinarie parkett</div>
                                    </div>
                                    <div class="ticket-field">
                                        <div class="ticket-label">Where</div>
                                        <div class="ticket-value">Stora Scen</div>
                                    </div>
                                </div>
                                <div class="ticket-col">
                                    <div class="ticket-field">
                                        <div class="ticket-label">Entry via</div>
                                        <div class="ticket-value">H√∂ger</div>
                                    </div>
                                    <div class="ticket-field">
                                        <div class="ticket-label">Row</div>
                                        <div class="ticket-value">13</div>
                                    </div>
                                    <div class="ticket-field">
                                        <div class="ticket-label">Seat</div>
                                        <div class="ticket-value">1326</div>
                                    </div>
                                    <div class="ticket-field">
                                        <div class="ticket-label">Starts</div>
                                        <div class="ticket-value">26 sep. 2025 19:30</div>
                                    </div>
                                    <div class="ticket-field">
                                        <div class="ticket-label">Entry</div>
                                        <div class="ticket-value">18:00</div>
                                    </div>
                                </div>
                            </div>

                            <div class="ticket-qr-area">
                                <div class="ticket-qr-box"></div>
                                <div class="ticket-qr-caption">XXXXXXXXX</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Extra vyer: lista, watch, l√•ssk√§rm -->
            <div class="extra-previews">
                <!-- Wallet-listvy -->
                <div>
                    <div class="mini-caption-title">Wallet ‚Äì listvy</div>
                    <div class="wallet-listcell">
                        <div class="wallet-list-icon" data-slot="list-icon">A</div>
                        <div>
                            <div class="wallet-list-text-main">Rockieli-plock</div>
                            <div class="wallet-list-text-sub">Eventbyr√•n ‚Ä¢ Stora Scen</div>
                        </div>
                    </div>
                    <div class="mini-caption">
                        Visar hur <code>icon.png</code> kan se ut i biljettslistan tillsammans med titel och plats.
                    </div>
                </div>

                <!-- Apple Watch -->
                <div>
                    <div class="mini-caption-title">Apple Watch ‚Äì biljettvy</div>
                    <div class="watch-preview">
                        <div class="watch-inner">
                            <div class="watch-header">
                                <div class="watch-icon" data-slot="watch-icon">A</div>
                                <div class="watch-title">Rockieli-plock</div>
                            </div>
                            <div class="watch-logo-strip">
                                <div class="watch-logo" data-slot="watch-logo"></div>
                                <div style="flex:1;height:8px;border-radius:999px;background:#e5e7eb;"></div>
                            </div>
                            <div class="watch-field-line">
                                <span>Starts</span><span>19:30</span>
                            </div>
                            <div class="watch-field-line">
                                <span>Row</span><span>13</span>
                            </div>
                            <div class="watch-field-line">
                                <span>Seat</span><span>1326</span>
                            </div>
                            <div class="watch-barcode"></div>
                        </div>
                    </div>
                    <div class="mini-caption">
                        F√∂renklad Watch-vy d√§r samma logga och ikon anv√§nds i ett kompakt format.
                    </div>
                </div>

                <!-- L√•ssk√§rm -->
                <div>
                    <div class="mini-caption-title">iPhone ‚Äì l√•ssk√§rm</div>
                    <div class="lockscreen-phone">
                        <div class="lockscreen-inner">
                            <div>
                                <div class="lockscreen-statusbar">
                                    <span>Fre 26 sep</span><span>üîã 100%</span>
                                </div>
                                <div class="lockscreen-time">19:10</div>
                            </div>
                            <div class="lockscreen-notification">
                                <div class="lockscreen-icon" data-slot="lockscreen-icon">A</div>
                                <div>
                                    <div style="font-size:0.78rem;font-weight:600;">Biljett √§r relevant</div>
                                    <div style="font-size:0.7rem;color:#9ca3af;">Rockieli-plock ‚Ä¢ Stora Scen</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mini-caption">
                        ‚ÄúL√•tsas-lockscreen‚Äù d√§r du kan se hur <code>icon.png</code> funkar superlitet i en notis.
                    </div>
                </div>
            </div>

            <p class="preview-note">
                N√§r du skapar en riktig <code>.pkpass</code> styr <code>pass.json</code> allt (pass-stil, f√§lt, f√§rger).
                Det h√§r verktyget hj√§lper dig med bildformat, filnamn och en layout som liknar en eventbiljett
                i olika vyer.
            </p>
        </section>
    </div>

    <script>
        // --- Storlekar (som i ditt original) ---
        const sizes = [
            { key: "icon",   name: "icon.png",      width: 29,  height: 29 },
            { key: "icon2x", name: "icon@2x.png",   width: 58,  height: 58 },
            { key: "icon3x", name: "icon@3x.png",   width: 87,  height: 87 },
            { key: "logo",   name: "logo.png",      width: 100, height: 50 },
            { key: "logo2x", name: "logo@2x.png",   width: 200, height: 100 },
            { key: "logo3x", name: "logo@3x.png",   width: 300, height: 150 },
        ];

        const useGlobalCheckbox = document.getElementById("useGlobal");
        const globalUpload = document.getElementById("globalUpload");
        const individualUploads = document.getElementById("individualUploads");
        const processBtn = document.getElementById("processBtn");
        const resetBtn = document.getElementById("resetBtn");
        const statusText = document.getElementById("statusText");
        const downloadLinksEl = document.getElementById("downloadLinks");

        // H√•ller senaste bilderna f√∂r f√∂rhandsvisning
        const previewState = {
            icon: null,
            logo: null
        };

        function setStatus(message, type = "info") {
            statusText.textContent = message || "";
            statusText.className = "status status--" + type;
        }

        function updateUploadMode() {
            const useGlobal = useGlobalCheckbox.checked;
            globalUpload.style.display = useGlobal ? "block" : "none";
            individualUploads.style.display = useGlobal ? "none" : "block";
        }

        useGlobalCheckbox.addEventListener("change", updateUploadMode);

        resetBtn.addEventListener("click", () => {
            downloadLinksEl.innerHTML = "";
            setStatus("Resultat rensat.", "info");

            // Nollst√§ll preview
            previewState.icon = null;
            previewState.logo = null;
            resetPreviewImages();
        });

        processBtn.addEventListener("click", processImages);

        function processImages() {
            const useGlobal = useGlobalCheckbox.checked;
            const globalFile = document.getElementById("globalFile").files[0];
            const files = {};
            const uploadedFileNames = [];

            if (useGlobal) {
                if (!globalFile) {
                    alert("Ladda upp en bild eller avmarkera 'En bild f√∂r alla'.");
                    setStatus("Ingen bild vald.", "error");
                    return;
                }
                sizes.forEach(size => {
                    files[size.key] = globalFile;
                });
                uploadedFileNames.push(globalFile.name);
            } else {
                document.querySelectorAll(".file-input").forEach(input => {
                    if (input.files[0]) {
                        files[input.dataset.key] = input.files[0];
                        uploadedFileNames.push(input.files[0].name);
                    }
                });

                if (Object.keys(files).length === 0) {
                    alert("Ladda upp minst en bild (global eller per storlek).");
                    setStatus("Inga filer uppladdade.", "error");
                    return;
                }
            }

            // GTM tracking: fil-UPPLADDNING
            if (window.dataLayer) {
                window.dataLayer.push({
                    event: "walletfixer_upload",
                    use_global: useGlobal,
                    files_count: Object.keys(files).length,
                    uploaded_file_names: uploadedFileNames.join(",")
                });
            }

            downloadLinksEl.innerHTML = "";
            setStatus("Skalar om bilder...", "info");
            processBtn.disabled = true;

            let processedCount = 0;
            let targetCount = 0;

            sizes.forEach(size => {
                if (files[size.key]) {
                    targetCount++;
                    resizeImage(files[size.key], size, () => {
                        processedCount++;
                        if (processedCount === targetCount) {
                            setStatus("Klar! " + processedCount + " filer skapade.", "ok");
                            processBtn.disabled = false;
                        }
                    });
                }
            });

            if (targetCount === 0) {
                setStatus("Inga matchade storlekar hittades f√∂r de uppladdade bilderna.", "error");
                processBtn.disabled = false;
            }
        }

        function resizeImage(file, size, onDone) {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const imgWidth = img.width;
                    const imgHeight = img.height;
                    let newWidth, newHeight;

                    if (imgWidth / imgHeight > size.width / size.height) {
                        newWidth = size.width;
                        newHeight = (imgHeight / imgWidth) * size.width;
                    } else {
                        newHeight = size.height;
                        newWidth = (imgWidth / imgHeight) * size.height;
                    }

                    const canvas = document.createElement("canvas");
                    canvas.width = size.width;
                    canvas.height = size.height;
                    const ctx = canvas.getContext("2d");

                    const offsetX = (size.width - newWidth) / 2;
                    const offsetY = (size.height - newHeight) / 2;

                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, offsetX, offsetY, newWidth, newHeight);

                    // DataURL f√∂r preview
                    const dataUrl = canvas.toDataURL("image/png");
                    updatePreviewFromAsset(size.key, dataUrl);

                    // Blob f√∂r nedladdning
                    canvas.toBlob(blob => {
                        const url = URL.createObjectURL(blob);
                        addDownloadItem(size, url);

                        // GTM tracking sker vid klick i l√§nken

                        if (typeof onDone === "function") onDone();
                    }, "image/png");
                };
                img.src = e.target.result;
            };
        }

        function addDownloadItem(size, url) {
            const item = document.createElement("div");
            item.className = "asset-item";

            const header = document.createElement("div");
            header.className = "asset-header";

            const nameSpan = document.createElement("span");
            nameSpan.className = "asset-name";
            nameSpan.textContent = size.name;

            const pill = document.createElement("span");
            pill.className = "asset-size-pill";
            pill.textContent = size.width + " √ó " + size.height + " px";

            header.appendChild(nameSpan);
            header.appendChild(pill);

            const actions = document.createElement("div");
            actions.className = "asset-actions";

            const link = document.createElement("a");
            link.href = url;
            link.download = size.name;
            link.innerText = "Ladda ner";

            link.addEventListener("click", () => {
                if (window.dataLayer) {
                    window.dataLayer.push({
                        event: "walletfixer_download",
                        file_name: size.name,
                        width: size.width,
                        height: size.height
                    });
                }
            });

            actions.appendChild(link);

            item.appendChild(header);
            item.appendChild(actions);

            downloadLinksEl.appendChild(item);
        }

        // --- F√∂rhandsvisning: uppdatera alla vyer med nya bilder ---
        function updatePreviewFromAsset(key, dataUrl) {
            if (key.startsWith("icon")) {
                previewState.icon = dataUrl;
            }
            if (key.startsWith("logo")) {
                previewState.logo = dataUrl;
            }

            applyPreviewImages();
        }

        function applyPreviewImages() {
            const logoEls = document.querySelectorAll("[data-slot='logo']");
            const listIconEls = document.querySelectorAll("[data-slot='list-icon']");
            const watchIconEls = document.querySelectorAll("[data-slot='watch-icon']");
            const watchLogoEls = document.querySelectorAll("[data-slot='watch-logo']");
            const lockscreenIconEls = document.querySelectorAll("[data-slot='lockscreen-icon']");

            // Logo i full biljettvy
            logoEls.forEach(el => {
                if (previewState.logo) {
                    el.style.backgroundImage = "url(" + previewState.logo + ")";
                } else {
                    el.style.backgroundImage = "";
                }
            });

            // Wallet-listvy-ikon
            listIconEls.forEach(el => {
                if (previewState.icon) {
                    el.style.backgroundImage = "url(" + previewState.icon + ")";
                    el.classList.add("has-image");
                    el.textContent = "";
                } else {
                    el.style.backgroundImage = "";
                    el.classList.remove("has-image");
                    el.textContent = "A";
                }
            });

            // Watch-icon + logo
            watchIconEls.forEach(el => {
                if (previewState.icon) {
                    el.style.backgroundImage = "url(" + previewState.icon + ")";
                    el.classList.add("has-image");
                    el.textContent = "";
                } else {
                    el.style.backgroundImage = "";
                    el.classList.remove("has-image");
                    el.textContent = "A";
                }
            });

            watchLogoEls.forEach(el => {
                if (previewState.logo) {
                    el.style.backgroundImage = "url(" + previewState.logo + ")";
                } else {
                    el.style.backgroundImage = "";
                }
            });

            // L√•ssk√§rmens lilla icon
            lockscreenIconEls.forEach(el => {
                if (previewState.icon) {
                    el.style.backgroundImage = "url(" + previewState.icon + ")";
                    el.classList.add("has-image");
                    el.textContent = "";
                } else {
                    el.style.backgroundImage = "";
                    el.classList.remove("has-image");
                    el.textContent = "A";
                }
            });
        }

        function resetPreviewImages() {
            previewState.icon = null;
            previewState.logo = null;
            applyPreviewImages();
        }

        // Init
        window.addEventListener("DOMContentLoaded", () => {
            updateUploadMode();
            setStatus("Redo. Ladda upp en bild och klicka p√• \"Skala om & skapa filer\".", "info");
            resetPreviewImages();
        });
    </script>
</body>
</html>
