<!DOCTYPE html>
<html lang="sv">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-E6BYGDHEZ9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-E6BYGDHEZ9');
    </script>

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KKPQ9SDX');</script>
    <!-- End Google Tag Manager -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>August's Wallet Bildverktyg</title>

    <style>
        :root {
            --blue: #2563eb;
            --blue-dark: #1d4ed8;
            --green: #16a34a;
            --orange: #f97316;
            --border: #d1d5db;
            --bg: #f3f4f6;
            --text: #111827;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 1.5rem;
            background: var(--bg);
            color: var(--text);
        }

        .page {
            max-width: 1100px;
            margin: 0 auto;
        }

        h1 {
            margin-top: 0;
            font-size: 2rem;
            text-align: center;
            margin-bottom: 0.25rem;
        }

        .lead {
            text-align: center;
            color: #4b5563;
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
        }

        .card {
            background: #fff;
            padding: 1.5rem 1.75rem;
            border-radius: 0.9rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            margin-bottom: 1.5rem;
        }

        .card h2 {
            margin-top: 0;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 1.6rem;
            height: 1.6rem;
            border-radius: 999px;
            background: var(--blue);
            color: white;
            font-size: 0.9rem;
            font-weight: 700;
        }

        .field-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }

        input[type="file"],
        input[type="checkbox"] {
            font-family: inherit;
        }

        input[type="file"] {
            font-size: 0.9rem;
        }

        .help {
            font-size: 0.8rem;
            color: #6b7280;
            margin-top: 0.2rem;
        }

        .row {
            display: flex;
            flex-wrap: wrap;
            gap: 0.9rem;
        }

        .row > .col {
            flex: 1 1 220px;
            min-width: 0;
        }

        .checkbox-line {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
        }

        button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.35rem;
            padding: 0.6rem 1.2rem;
            border-radius: 999px;
            border: none;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            background: var(--blue);
            color: white;
            box-shadow: 0 4px 12px rgba(37,99,235,0.35);
            transition: transform 0.05s ease, box-shadow 0.05s ease, background 0.2s;
        }

        button:disabled {
            opacity: 0.6;
            cursor: default;
            box-shadow: none;
        }

        button:not(:disabled):hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 18px rgba(37,99,235,0.45);
            background: var(--blue-dark);
        }

        .btn-secondary {
            background: #6b7280;
            box-shadow: 0 4px 12px rgba(55,65,81,0.35);
        }
        .btn-secondary:hover:not(:disabled) {
            background: #4b5563;
        }

        .btn-green {
            background: var(--green);
            box-shadow: 0 4px 12px rgba(22,163,74,0.4);
        }
        .btn-green:hover:not(:disabled) {
            background: #15803d;
        }

        .status {
            margin-top: 0.5rem;
            font-size: 0.85rem;
            min-height: 1.2rem;
        }

        .status--info {
            color: #374151;
        }

        .status--ok {
            color: #065f46;
        }

        .status--error {
            color: #b91c1c;
        }

        .asset-list {
            margin-top: 1rem;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
            gap: 0.75rem;
        }

        .asset-item {
            background: #f9fafb;
            border-radius: 0.75rem;
            border: 1px solid #e5e7eb;
            padding: 0.75rem 0.9rem;
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        .asset-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
        }

        .asset-name {
            font-weight: 600;
        }

        .asset-size-pill {
            padding: 0.1rem 0.5rem;
            border-radius: 999px;
            background: #e5e7eb;
            font-size: 0.75rem;
            color: #4b5563;
        }

        .asset-actions {
            margin-top: 0.2rem;
        }

        .asset-actions a {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.3rem 0.85rem;
            border-radius: 999px;
            text-decoration: none;
            background: var(--orange);
            color: #fff;
            font-size: 0.8rem;
            box-shadow: 0 2px 8px rgba(249,115,22,0.4);
        }

        .asset-actions a:hover {
            background: #ea580c;
        }

        /* Wallet previews */
        .preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 1rem;
            margin-top: 0.75rem;
        }

        .wallet-preview {
            border-radius: 1rem;
            background: linear-gradient(135deg, #4f46e5, #0ea5e9);
            padding: 0.65rem 0.75rem 0.9rem;
            color: #f9fafb;
            box-shadow: 0 6px 20px rgba(15,23,42,0.35);
            position: relative;
            overflow: hidden;
            font-size: 0.8rem;
        }

        .wallet-preview::before {
            content: "";
            position: absolute;
            inset: 0;
            background-image: radial-gradient(circle at top left, rgba(255,255,255,0.18), transparent 50%);
            opacity: 0.7;
            pointer-events: none;
        }

        .wallet-inner {
            position: relative;
            z-index: 1;
        }

        .wallet-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.4rem;
        }

        .wallet-type-pill {
            padding: 0.1rem 0.5rem;
            border-radius: 999px;
            background: rgba(15,23,42,0.35);
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .wallet-icon-circle {
            width: 26px;
            height: 26px;
            border-radius: 999px;
            background: rgba(15,23,42,0.35);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .wallet-icon-circle span {
            font-size: 0.8rem;
            font-weight: 600;
        }

        .wallet-icon-circle.has-image {
            background-size: cover;
            background-position: center;
            background-color: #111827;
        }

        .wallet-logo-strip {
            margin-bottom: 0.5rem;
            border-radius: 0.55rem;
            background: rgba(15,23,42,0.38);
            padding: 0.35rem 0.55rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            overflow: hidden;
        }

        .wallet-logo {
            width: 90px;
            height: 28px;
            border-radius: 0.35rem;
            background: rgba(15,23,42,0.75);
            overflow: hidden;
            background-position: center;
            background-size: contain;
            background-repeat: no-repeat;
            flex-shrink: 0;
        }

        .wallet-strip {
            flex: 1;
            height: 26px;
            border-radius: 0.35rem;
            background: linear-gradient(90deg, rgba(255,255,255,0.22), rgba(255,255,255,0.05));
            opacity: 0.9;
        }

        .wallet-main {
            display: flex;
            align-items: flex-start;
            gap: 0.6rem;
        }

        .wallet-fields {
            flex: 1;
        }

        .wallet-line-strong {
            font-weight: 600;
            font-size: 0.85rem;
        }

        .wallet-line-muted {
            font-size: 0.78rem;
            opacity: 0.9;
        }

        .wallet-thumb {
            width: 42px;
            height: 42px;
            border-radius: 0.4rem;
            background: rgba(15,23,42,0.4);
            flex-shrink: 0;
            background-position: center;
            background-size: cover;
            background-repeat: no-repeat;
        }

        .wallet-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 0.55rem;
        }

        .wallet-barcode {
            flex: 1;
            height: 14px;
            border-radius: 99px;
            background-image: repeating-linear-gradient(
                to right,
                rgba(15,23,42,0.7) 0,
                rgba(15,23,42,0.7) 4px,
                transparent 4px,
                transparent 7px
            );
            opacity: 0.9;
        }

        .wallet-chip {
            margin-left: 0.5rem;
            padding: 0.1rem 0.5rem;
            border-radius: 999px;
            background: rgba(15,23,42,0.4);
            font-size: 0.7rem;
        }

        .preview-note {
            font-size: 0.8rem;
            color: #6b7280;
            margin-top: 0.4rem;
        }

        /* --- Extra vyer: listvy, watch, l√•ssk√§rm --- */
        .extra-previews {
            display: flex;
            flex-wrap: wrap;
            gap: 1.2rem;
            margin-top: 1.5rem;
            align-items: flex-start;
        }

        .wallet-listcell {
            width: 260px;
            border-radius: 0.85rem;
            background: #111827;
            padding: 0.55rem 0.7rem;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            color: #e5e7eb;
            box-shadow: 0 8px 18px rgba(15,23,42,0.45);
            font-size: 0.8rem;
        }

        .wallet-list-icon {
            width: 24px;
            height: 24px;
            border-radius: 0.7rem;
            background: #020617;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            overflow: hidden;
            background-position: center;
            background-size: cover;
            background-repeat: no-repeat;
        }

        .wallet-list-icon.has-image {
            color: transparent;
        }

        .wallet-list-text-main {
            font-weight: 600;
        }

        .wallet-list-text-sub {
            font-size: 0.72rem;
            color: #9ca3af;
        }

        .watch-preview {
            width: 160px;
            height: 200px;
            border-radius: 1.9rem;
            padding: 0.5rem;
            background: radial-gradient(circle at top, #020617, #0b1120 70%);
            box-shadow: 0 14px 26px rgba(15,23,42,0.6);
            color: #e5e7eb;
            font-size: 0.75rem;
            position: relative;
        }

        .watch-inner {
            width: 100%;
            height: 100%;
            border-radius: 1.5rem;
            padding: 0.5rem;
            background: linear-gradient(135deg, rgba(148,163,184,0.3), rgba(15,23,42,0.95));
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
        }

        .watch-header {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .watch-icon {
            width: 20px;
            height: 20px;
            border-radius: 0.6rem;
            background: #0f172a;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
            overflow: hidden;
            background-position: center;
            background-size: cover;
            background-repeat: no-repeat;
        }

        .watch-icon.has-image {
            color: transparent;
        }

        .watch-logo-strip {
            margin-top: 0.2rem;
            border-radius: 0.5rem;
            background: rgba(15,23,42,0.75);
            padding: 0.3rem 0.4rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .watch-logo {
            width: 60px;
            height: 18px;
            border-radius: 0.3rem;
            background: rgba(15,23,42,0.9);
            background-position: center;
            background-size: contain;
            background-repeat: no-repeat;
        }

        .watch-field-line {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            margin-top: 0.2rem;
        }

        .watch-barcode {
            margin-top: auto;
            height: 12px;
            border-radius: 999px;
            background-image: repeating-linear-gradient(
                to right,
                rgba(15,23,42,0.9) 0,
                rgba(15,23,42,0.9) 4px,
                transparent 4px,
                transparent 7px
            );
        }

        .lockscreen-phone {
            width: 210px;
            aspect-ratio: 9 / 19.5;
            border-radius: 2rem;
            padding: 0.7rem;
            background: radial-gradient(circle at top, #1f2937, #020617 70%);
            box-shadow: 0 18px 35px rgba(15,23,42,0.65);
            position: relative;
            color: #e5e7eb;
            font-size: 0.7rem;
            overflow: hidden;
        }

        .lockscreen-inner {
            width: 100%;
            height: 100%;
            border-radius: 1.6rem;
            padding: 0.6rem 0.5rem;
            background: linear-gradient(to bottom, rgba(148,163,184,0.1), rgba(15,23,42,0.6));
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .lockscreen-statusbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.65rem;
            opacity: 0.7;
        }

        .lockscreen-time {
            text-align: center;
            margin-top: 0.35rem;
            font-size: 1.7rem;
            font-weight: 500;
        }

        .lockscreen-notification {
            margin-top: auto;
            background: rgba(15,23,42,0.85);
            border-radius: 1.1rem;
            padding: 0.5rem 0.55rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 8px 18px rgba(0,0,0,0.45);
        }

        .lockscreen-icon {
            width: 26px;
            height: 26px;
            border-radius: 0.7rem;
            background: #111827;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
            color: #e5e7eb;
            overflow: hidden;
            background-position: center;
            background-size: cover;
            background-repeat: no-repeat;
        }

        .lockscreen-icon.has-image {
            color: transparent;
        }

        .mini-caption {
            font-size: 0.8rem;
            color: #6b7280;
            margin-top: 0.35rem;
            max-width: 260px;
        }

        @media (max-width: 640px) {
            .card {
                padding: 1.2rem 1.1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KKPQ9SDX"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <div class="page">
        <h1>Augusts Wallet-bildverktyg</h1>
        <p class="lead">
            Ladda upp en eller flera bilder och f√• ut f√§rdiga <strong>icon</strong> &amp; <strong>logo</strong>-filer
            i r√§tt storlek/namn ‚Äì plus f√∂rhandsvisningar av hur de kan se ut i olika Wallet-vyer (full vy, lista, Apple Watch och l√•ssk√§rm).
        </p>

        <!-- STEG 1: UPPLADDNING & SKALNING -->
        <section class="card">
            <h2><span class="badge">1</span> Ladda upp bilder &amp; skala om</h2>

            <div class="field-group">
                <label class="checkbox-line">
                    <input type="checkbox" id="useGlobal" />
                    En bild f√∂r alla storlekar
                </label>
                <div class="help">
                    Bockad = samma original anv√§nds f√∂r alla varianter (icon/logo i alla @-storlekar).<br>
                    Avbockad = du kan ladda upp egna filer per storlek.
                </div>
            </div>

            <div id="globalUpload" class="field-group">
                <label for="globalFile">En bild f√∂r alla:</label>
                <input type="file" id="globalFile" accept="image/*">
                <div class="help">
                    Helst en h√∂guppl√∂st kvadratisk bild (t.ex. 1024√ó1024) med transparens.
                </div>
            </div>

            <div id="individualUploads" class="field-group">
                <div class="row">
                    <div class="col">
                        <label>Icon (liten symbol)</label>
                        <input type="file" class="file-input" data-key="icon" accept="image/*">
                        <div class="help">icon.png ‚Äì 29√ó29 px</div>
                    </div>
                    <div class="col">
                        <label>Icon @2x</label>
                        <input type="file" class="file-input" data-key="icon2x" accept="image/*">
                        <div class="help">icon@2x.png ‚Äì 58√ó58 px</div>
                    </div>
                    <div class="col">
                        <label>Icon @3x</label>
                        <input type="file" class="file-input" data-key="icon3x" accept="image/*">
                        <div class="help">icon@3x.png ‚Äì 87√ó87 px</div>
                    </div>
                </div>

                <div class="row" style="margin-top:0.75rem;">
                    <div class="col">
                        <label>Logo (huvudlogotyp)</label>
                        <input type="file" class="file-input" data-key="logo" accept="image/*">
                        <div class="help">logo.png ‚Äì 100√ó50 px (Apple f√∂resl√•r 160√ó50 pt)</div>
                    </div>
                    <div class="col">
                        <label>Logo @2x</label>
                        <input type="file" class="file-input" data-key="logo2x" accept="image/*">
                        <div class="help">logo@2x.png ‚Äì 200√ó100 px</div>
                    </div>
                    <div class="col">
                        <label>Logo @3x</label>
                        <input type="file" class="file-input" data-key="logo3x" accept="image/*">
                        <div class="help">logo@3x.png ‚Äì 300√ó150 px</div>
                    </div>
                </div>
            </div>

            <div class="field-group">
                <div class="row" style="align-items:center;">
                    <div class="col" style="flex:0 0 auto;">
                        <button id="processBtn" type="button">Skala om &amp; skapa filer</button>
                    </div>
                    <div class="col" style="flex:0 0 auto;">
                        <button id="resetBtn" type="button" class="btn-secondary">Rensa resultat</button>
                    </div>
                </div>
                <div id="statusText" class="status status--info"></div>
            </div>

            <div id="downloadLinks" class="asset-list"></div>
        </section>

        <!-- STEG 2: F√ñRHANDSVISNING -->
        <section class="card">
            <h2><span class="badge">2</span> F√∂rhandsvisning ‚Äì ungef√§r hur det kan se ut</h2>
            <p class="help">
                Det h√§r √§r inte en exakt 1:1-rendering av Wallet, men ger en k√§nsla f√∂r hur din
                <strong>icon</strong> och <strong>logo</strong> hamnar i olika passtyper och vyer
                (kupong, eventbiljett, medlemskort, listvy, Apple Watch, l√•ssk√§rm).
            </p>

            <div class="preview-grid">
                <!-- Kupong -->
                <div class="wallet-preview">
                    <div class="wallet-inner">
                        <div class="wallet-top">
                            <div class="wallet-type-pill">Kupong</div>
                            <div class="wallet-icon-circle" data-slot="icon">
                                <span>A</span>
                            </div>
                        </div>
                        <div class="wallet-logo-strip">
                            <div class="wallet-logo" data-slot="logo"></div>
                            <div class="wallet-strip"></div>
                        </div>
                        <div class="wallet-main">
                            <div class="wallet-fields">
                                <div class="wallet-line-strong">20% p√• utvalt sortiment</div>
                                <div class="wallet-line-muted">G√§ller t.o.m. 31/12 ‚Ä¢ Butik & online</div>
                            </div>
                            <div class="wallet-thumb" data-slot="thumb"></div>
                        </div>
                        <div class="wallet-bottom">
                            <div class="wallet-barcode"></div>
                            <div class="wallet-chip">Kupong-ID ‚Ä¢ 123456</div>
                        </div>
                    </div>
                </div>

                <!-- Eventbiljett -->
                <div class="wallet-preview" style="background: linear-gradient(135deg,#ec4899,#8b5cf6);">
                    <div class="wallet-inner">
                        <div class="wallet-top">
                            <div class="wallet-type-pill">Eventbiljett</div>
                            <div class="wallet-icon-circle" data-slot="icon">
                                <span>A</span>
                            </div>
                        </div>
                        <div class="wallet-logo-strip">
                            <div class="wallet-logo" data-slot="logo"></div>
                            <div class="wallet-strip"></div>
                        </div>
                        <div class="wallet-main">
                            <div class="wallet-fields">
                                <div class="wallet-line-strong">Live Session</div>
                                <div class="wallet-line-muted">Ons 19:30 ‚Ä¢ Rad 7, plats 12</div>
                            </div>
                            <div class="wallet-thumb" data-slot="thumb"></div>
                        </div>
                        <div class="wallet-bottom">
                            <div class="wallet-barcode"></div>
                            <div class="wallet-chip">Entr√© ‚Ä¢ 1 person</div>
                        </div>
                    </div>
                </div>

                <!-- Generiskt kort -->
                <div class="wallet-preview" style="background: linear-gradient(135deg,#0f766e,#22c55e);">
                    <div class="wallet-inner">
                        <div class="wallet-top">
                            <div class="wallet-type-pill">Medlemskort</div>
                            <div class="wallet-icon-circle" data-slot="icon">
                                <span>A</span>
                            </div>
                        </div>
                        <div class="wallet-logo-strip">
                            <div class="wallet-logo" data-slot="logo"></div>
                            <div class="wallet-strip"></div>
                        </div>
                        <div class="wallet-main">
                            <div class="wallet-fields">
                                <div class="wallet-line-strong">August Ekelund</div>
                                <div class="wallet-line-muted">Medlemsniv√•: Pro ‚Ä¢ Saldo: 450 kr</div>
                            </div>
                            <div class="wallet-thumb" data-slot="thumb"></div>
                        </div>
                        <div class="wallet-bottom">
                            <div class="wallet-barcode"></div>
                            <div class="wallet-chip">Visa i kassan</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Extra vyer: listvy, watch, l√•ssk√§rm -->
            <div class="extra-previews">
                <div>
                    <div class="wallet-listcell">
                        <div class="wallet-list-icon" data-slot="list-icon">A</div>
                        <div>
                            <div class="wallet-list-text-main">Wallet-listvy</div>
                            <div class="wallet-list-text-sub">S√• h√§r kan det se ut i listan.</div>
                        </div>
                    </div>
                    <div class="mini-caption">
                        Visar hur <code>icon.png</code> kan se ut i sj√§lva Wallet-listan bland andra pass.
                    </div>
                </div>

                <div>
                    <div class="watch-preview">
                        <div class="watch-inner">
                            <div class="watch-header">
                                <div class="watch-icon" data-slot="watch-icon">A</div>
                                <div>Konsert-pass</div>
                            </div>
                            <div class="watch-logo-strip">
                                <div class="watch-logo" data-slot="watch-logo"></div>
                                <div style="flex:1;height:8px;border-radius:999px;background:rgba(15,23,42,0.85);"></div>
                            </div>
                            <div class="watch-field-line">
                                <span>Event</span><span>19:30 idag</span>
                            </div>
                            <div class="watch-field-line">
                                <span>Plats</span><span>Rad 7 ‚Ä¢ 12</span>
                            </div>
                            <div class="watch-barcode"></div>
                        </div>
                    </div>
                    <div class="mini-caption">
                        F√∂renklad vy av hur samma pass kan uppfattas p√• Apple Watch (logo + icon + f√§lt).
                    </div>
                </div>

                <div>
                    <div class="lockscreen-phone">
                        <div class="lockscreen-inner">
                            <div>
                                <div class="lockscreen-statusbar">
                                    <span>08:41</span><span>üîã 100%</span>
                                </div>
                                <div class="lockscreen-time">9:41</div>
                            </div>
                            <div class="lockscreen-notification">
                                <div class="lockscreen-icon" data-slot="lockscreen-icon">A</div>
                                <div>
                                    <div style="font-size:0.78rem;font-weight:600;">Wallet-pass</div>
                                    <div style="font-size:0.7rem;color:#9ca3af;">Tryck f√∂r att √∂ppna</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mini-caption">
                        En ‚Äúl√•tsas-lockscreen‚Äù d√§r endast <code>icon.png</code> anv√§nds ‚Äì bra f√∂r att se hur den funkar pytteliten.
                    </div>
                </div>
            </div>

            <p class="preview-note">
                N√§r du exporterar en riktig .pkpass best√§mmer layouten i <code>pass.json</code> (pass-stil,
                f√§lt m.m.) exakt var bilderna hamnar. Det h√§r verktyget fokuserar p√• bilderna ‚Äì format, namn
                och en snabb visuell k√§nsla i flera typiska Wallet-l√§gen.
            </p>
        </section>
    </div>

    <script>
        // --- Storlekar (som i ditt original) ---
        const sizes = [
            { key: "icon",   name: "icon.png",      width: 29,  height: 29 },
            { key: "icon2x", name: "icon@2x.png",   width: 58,  height: 58 },
            { key: "icon3x", name: "icon@3x.png",   width: 87,  height: 87 },
            { key: "logo",   name: "logo.png",      width: 100, height: 50 },
            { key: "logo2x", name: "logo@2x.png",   width: 200, height: 100 },
            { key: "logo3x", name: "logo@3x.png",   width: 300, height: 150 },
        ];

        const useGlobalCheckbox = document.getElementById("useGlobal");
        const globalUpload = document.getElementById("globalUpload");
        const individualUploads = document.getElementById("individualUploads");
        const processBtn = document.getElementById("processBtn");
        const resetBtn = document.getElementById("resetBtn");
        const statusText = document.getElementById("statusText");
        const downloadLinksEl = document.getElementById("downloadLinks");

        // H√•ller senaste bilderna f√∂r f√∂rhandsvisning
        const previewState = {
            icon: null,
            logo: null
        };

        function setStatus(message, type = "info") {
            statusText.textContent = message || "";
            statusText.className = "status status--" + type;
        }

        function updateUploadMode() {
            const useGlobal = useGlobalCheckbox.checked;
            globalUpload.style.display = useGlobal ? "block" : "none";
            individualUploads.style.display = useGlobal ? "none" : "block";
        }

        useGlobalCheckbox.addEventListener("change", updateUploadMode);

        resetBtn.addEventListener("click", () => {
            downloadLinksEl.innerHTML = "";
            setStatus("Resultat rensat.", "info");

            // Nollst√§ll preview
            previewState.icon = null;
            previewState.logo = null;
            resetPreviewImages();
        });

        processBtn.addEventListener("click", processImages);

        function processImages() {
            const useGlobal = useGlobalCheckbox.checked;
            const globalFile = document.getElementById("globalFile").files[0];
            const files = {};
            const uploadedFileNames = [];

            if (useGlobal) {
                if (!globalFile) {
                    alert("Ladda upp en bild eller avmarkera 'En bild f√∂r alla'.");
                    setStatus("Ingen bild vald.", "error");
                    return;
                }
                sizes.forEach(size => {
                    files[size.key] = globalFile;
                });
                uploadedFileNames.push(globalFile.name);
            } else {
                document.querySelectorAll(".file-input").forEach(input => {
                    if (input.files[0]) {
                        files[input.dataset.key] = input.files[0];
                        uploadedFileNames.push(input.files[0].name);
                    }
                });

                if (Object.keys(files).length === 0) {
                    alert("Ladda upp minst en bild (global eller per storlek).");
                    setStatus("Inga filer uppladdade.", "error");
                    return;
                }
            }

            // GTM tracking: fil-UPPLADDNING
            if (window.dataLayer) {
                window.dataLayer.push({
                    event: "walletfixer_upload",
                    use_global: useGlobal,
                    files_count: Object.keys(files).length,
                    uploaded_file_names: uploadedFileNames.join(",")
                });
            }

            downloadLinksEl.innerHTML = "";
            setStatus("Skalar om bilder...", "info");
            processBtn.disabled = true;

            let processedCount = 0;
            let targetCount = 0;

            sizes.forEach(size => {
                if (files[size.key]) {
                    targetCount++;
                    resizeImage(files[size.key], size, () => {
                        processedCount++;
                        if (processedCount === targetCount) {
                            setStatus("Klar! " + processedCount + " filer skapade.", "ok");
                            processBtn.disabled = false;
                        }
                    });
                }
            });

            if (targetCount === 0) {
                setStatus("Inga matchade storlekar hittades f√∂r de uppladdade bilderna.", "error");
                processBtn.disabled = false;
            }
        }

        function resizeImage(file, size, onDone) {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const imgWidth = img.width;
                    const imgHeight = img.height;
                    let newWidth, newHeight;

                    if (imgWidth / imgHeight > size.width / size.height) {
                        newWidth = size.width;
                        newHeight = (imgHeight / imgWidth) * size.width;
                    } else {
                        newHeight = size.height;
                        newWidth = (imgWidth / imgHeight) * size.height;
                    }

                    const canvas = document.createElement("canvas");
                    canvas.width = size.width;
                    canvas.height = size.height;
                    const ctx = canvas.getContext("2d");

                    const offsetX = (size.width - newWidth) / 2;
                    const offsetY = (size.height - newHeight) / 2;

                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, offsetX, offsetY, newWidth, newHeight);

                    // DataURL f√∂r preview
                    const dataUrl = canvas.toDataURL("image/png");
                    updatePreviewFromAsset(size.key, dataUrl);

                    // Blob f√∂r nedladdning
                    canvas.toBlob(blob => {
                        const url = URL.createObjectURL(blob);
                        addDownloadItem(size, url);

                        // GTM tracking sker vid klick i l√§nken

                        if (typeof onDone === "function") onDone();
                    }, "image/png");
                };
                img.src = e.target.result;
            };
        }

        function addDownloadItem(size, url) {
            const item = document.createElement("div");
            item.className = "asset-item";

            const header = document.createElement("div");
            header.className = "asset-header";

            const nameSpan = document.createElement("span");
            nameSpan.className = "asset-name";
            nameSpan.textContent = size.name;

            const pill = document.createElement("span");
            pill.className = "asset-size-pill";
            pill.textContent = size.width + " √ó " + size.height + " px";

            header.appendChild(nameSpan);
            header.appendChild(pill);

            const actions = document.createElement("div");
            actions.className = "asset-actions";

            const link = document.createElement("a");
            link.href = url;
            link.download = size.name;
            link.innerText = "Ladda ner";

            link.addEventListener("click", () => {
                if (window.dataLayer) {
                    window.dataLayer.push({
                        event: "walletfixer_download",
                        file_name: size.name,
                        width: size.width,
                        height: size.height
                    });
                }
            });

            actions.appendChild(link);

            item.appendChild(header);
            item.appendChild(actions);

            downloadLinksEl.appendChild(item);
        }

        // --- F√∂rhandsvisning: uppdatera Wallet-korten + listvy + watch + l√•ssk√§rm med nya bilder ---
        function updatePreviewFromAsset(key, dataUrl) {
            if (key.startsWith("icon")) {
                previewState.icon = dataUrl;
            }
            if (key.startsWith("logo")) {
                previewState.logo = dataUrl;
            }

            applyPreviewImages();
        }

        function applyPreviewImages() {
            const iconEls = document.querySelectorAll("[data-slot='icon']");
            const logoEls = document.querySelectorAll("[data-slot='logo']");
            const thumbEls = document.querySelectorAll("[data-slot='thumb']");
            const listIconEls = document.querySelectorAll("[data-slot='list-icon']");
            const watchIconEls = document.querySelectorAll("[data-slot='watch-icon']");
            const watchLogoEls = document.querySelectorAll("[data-slot='watch-logo']");
            const lockscreenIconEls = document.querySelectorAll("[data-slot='lockscreen-icon']");

            // Wallet-kortens icon
            iconEls.forEach(el => {
                if (previewState.icon) {
                    el.style.backgroundImage = "url(" + previewState.icon + ")";
                    el.classList.add("has-image");
                    el.innerHTML = "";
                } else {
                    el.style.backgroundImage = "";
                    el.classList.remove("has-image");
                    if (!el.querySelector("span")) {
                        const span = document.createElement("span");
                        span.textContent = "A";
                        el.appendChild(span);
                    }
                }
            });

            // Logo i Wallet-korten
            logoEls.forEach(el => {
                if (previewState.logo) {
                    el.style.backgroundImage = "url(" + previewState.logo + ")";
                } else {
                    el.style.backgroundImage = "";
                }
            });

            // Thumbnail-ruta: anv√§nd logga eller icon
            thumbEls.forEach(el => {
                if (previewState.logo || previewState.icon) {
                    el.style.backgroundImage = "url(" + (previewState.logo || previewState.icon) + ")";
                } else {
                    el.style.backgroundImage = "";
                }
            });

            // Wallet-listvy-ikon
            listIconEls.forEach(el => {
                if (previewState.icon) {
                    el.style.backgroundImage = "url(" + previewState.icon + ")";
                    el.classList.add("has-image");
                    el.textContent = "";
                } else {
                    el.style.backgroundImage = "";
                    el.classList.remove("has-image");
                    el.textContent = "A";
                }
            });

            // Watch-icon + logo
            watchIconEls.forEach(el => {
                if (previewState.icon) {
                    el.style.backgroundImage = "url(" + previewState.icon + ")";
                    el.classList.add("has-image");
                    el.textContent = "";
                } else {
                    el.style.backgroundImage = "";
                    el.classList.remove("has-image");
                    el.textContent = "A";
                }
            });

            watchLogoEls.forEach(el => {
                if (previewState.logo) {
                    el.style.backgroundImage = "url(" + previewState.logo + ")";
                } else {
                    el.style.backgroundImage = "";
                }
            });

            // L√•ssk√§rmens lilla icon
            lockscreenIconEls.forEach(el => {
                if (previewState.icon) {
                    el.style.backgroundImage = "url(" + previewState.icon + ")";
                    el.classList.add("has-image");
                    el.textContent = "";
                } else {
                    el.style.backgroundImage = "";
                    el.classList.remove("has-image");
                    el.textContent = "A";
                }
            });
        }

        function resetPreviewImages() {
            previewState.icon = null;
            previewState.logo = null;
            applyPreviewImages();
        }

        // Init
        window.addEventListener("DOMContentLoaded", () => {
            updateUploadMode();
            setStatus("Redo. Ladda upp en bild och klicka p√• \"Skala om & skapa filer\".", "info");
            resetPreviewImages();
        });
    </script>
</body>
</html>
